<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menú Administrador</title>
    <link rel="stylesheet" href="/css/login.css">
    <link rel="stylesheet" href="/css/menu-admin.css">
    <!-- Styles moved to /css/menu-admin.css -->
</head>
<body class="admin">
    <div class="header">
        <h1>Panel de Administrador</h1>
        <div class="user-info">
            Bienvenido, <span id="nombreUsuario"></span>
        </div>
    </div>
    <!-- Pestañas modernas: un solo contenedor con 3 pestañas -->
    <div class="admin-sections tabs-container">
        <div class="tabs">
            <button class="tab-btn active" data-tab="tab-emular">Emular tránsito</button>
            <button class="tab-btn" data-tab="tab-bonificaciones">Asignar bonificaciones</button>
            <button class="tab-btn" data-tab="tab-cambiar-estado">Cambiar estado</button>
        </div>

        <div class="tab-contents">
            <div id="tab-emular" class="tab-panel active menu-item">
                <div class="section-header"><h3>Emular tránsito</h3></div>
                <div class="section-body">
                    <p>Simula el paso de un vehículo por un peaje.</p>
                    <form id="form-emular" onsubmit="event.preventDefault();">
                        <label for="matricula">Matrícula</label>
                        <input id="matricula" type="text" placeholder="ABC1234">

                        <label for="peajeSelect">Peaje</label>
                        <select id="peajeSelect">
                            <!-- carga dinamica -->
                        </select>

                        <label for="categoriaSelect">Categoría</label>
                        <select id="categoriaSelect">
                            <!-- carga dinamica -->
                        </select>

                        <div class="action-row">
                            <button class="action-btn" id="btn-emular">Emular</button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="tab-bonificaciones" class="tab-panel menu-item">
                <div class="section-header"><h3>Asignar bonificaciones</h3></div>
                <div class="section-body">
                    <p>Asignar bonificaciones a un propietario o vehículo.</p>
                    <form id="form-bonificaciones" onsubmit="event.preventDefault();">
                        <label for="bon-propietario">Propietario (cédula)</label>
                        <input id="bon-propietario" type="text" placeholder="11111111">

                        <label for="bon-tipo">Tipo de bonificación</label>
                        <select id="bon-tipo">
                            <option>Descuento por pago anticipado</option>
                            <option>Promoción</option>
                        </select>

                        <label for="bon-monto">Monto/Porcentaje</label>
                        <input id="bon-monto" type="text" placeholder="10% / $100">

                        <div class="action-row">
                            <button class="action-btn" id="btn-asignar">Asignar</button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="tab-cambiar-estado" class="tab-panel menu-item">
                <div class="section-header"><h3>Cambiar estado del propietario</h3></div>
                <div class="section-body">
                    <p>Modificar el estado actual</p>
                    <form id="form-cambiar-estado" onsubmit="event.preventDefault();">
                        <label for="estado-propietario">Propietario (cédula)</label>
                        <input id="estado-propietario" type="text" placeholder="1">

                        <label for="estado-select">Estado</label>
                        <select id="estado-select">
                            <option>Habilitado</option>
                            <option>Penalizado</option>
                            <option>Suspendido</option>
                            <option>Deshabilitado</option>
                        </select>

                        <div class="action-row">
                            <button class="action-btn" id="btn-cambiar-estado">Cambiar estado</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="/utilesVista.js"></script>
    <script src="/vistaWeb.js"></script>
    <script>
        // Inicialización de la vista
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar la URL para iniciar la vista
            urlIniciarVista = "/acceso/iniciarAdministrador";
            
            // Manejar cierre de sesión cuando se cierra la ventana
            urlCierreVista = "/acceso/cerrarSesion";

            // Cargar lista de puestos para el select de Emular tránsito
        cargarPuestos();
        cargarCategorias();
        initTabs();
        });

            // Inicializa el comportamiento de las pestañas
            function initTabs() {
                const tabButtons = document.querySelectorAll('.tab-btn');
                tabButtons.forEach(btn => {
                    btn.addEventListener('click', () => switchTab(btn.dataset.tab));
                    btn.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            switchTab(btn.dataset.tab);
                        }
                    });
                });
            }

            function switchTab(tabId) {
                // buttons
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                const activeBtn = document.querySelector(`.tab-btn[data-tab="${tabId}"]`);
                if (activeBtn) activeBtn.classList.add('active');

                // panels
                document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
                const panel = document.getElementById(tabId);
                if (panel) panel.classList.add('active');

                // lazy load puestos when switching to emular
                if (tabId === 'tab-emular') {
                    const sel = document.getElementById('peajeSelect');
                    if (sel && sel.options.length === 0) cargarPuestos();
                    const selCat = document.getElementById('categoriaSelect');
                    if (selCat && selCat.options.length === 0) cargarCategorias();
                    document.getElementById('matricula').focus();
                }
            }

        // Cargar puestos desde el backend y poblar el select
        async function cargarPuestos() {
            try {
                const resp = await fetch('/puestos/listar');
                if (!resp.ok) throw new Error('Error al obtener puestos');
                const lista = await resp.json();
                const sel = document.getElementById('peajeSelect');
                if (!sel) return;
                sel.innerHTML = '';
                lista.forEach(nombre => {
                    const opt = document.createElement('option');
                    opt.value = nombre;
                    opt.textContent = nombre;
                    sel.appendChild(opt);
                });
            } catch (e) {
                console.error('No se pudieron cargar los puestos:', e);
            }
        }

        // Cargar categorías desde el backend y poblar el select
        async function cargarCategorias() {
            try {
                const resp = await fetch('/categorias/listar');
                if (!resp.ok) throw new Error('Error al obtener categorías');
                const lista = await resp.json();
                const sel = document.getElementById('categoriaSelect');
                if (!sel) return;
                sel.innerHTML = '';
                lista.forEach(nombre => {
                    const opt = document.createElement('option');
                    opt.value = nombre;
                    opt.textContent = nombre;
                    sel.appendChild(opt);
                });
            } catch (e) {
                console.error('No se pudieron cargar las categorías:', e);
            }
        }

        // Función para mostrar datos del usuario
        function mostrar_datosUsuario(datos) {
            document.getElementById('nombreUsuario').textContent = datos.nombre + " " + datos.apellido;
        }
    </script>
</body>
</html>